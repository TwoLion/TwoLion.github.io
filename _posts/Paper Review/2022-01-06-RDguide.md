---
layout: single
title:  "Regression discontinuity designs: A guide to practice"
categories: [Paper Review]
tag: [Causal Inference, Regression discontinuity design]
toc: true
author_profile: false #프로필 생략 여부
use_math: true
sidebar:
    nav: "docs"
---



















이번 논문은 인과 추론의 방법 중 Regression Discontinuity Design에 대한 대략적인 가이드 논문입니다. Cutoff에 의해서 treatment 부여 여부가 결정될 때, cutoff 근방의 outcome을 비교하여 treatment effect를 파악하는 Regression discontinuity design에 대해 알아보겠습니다.





<br/>



### 1. Sharp and FRD designs



<br/>



#### 1.1 Basic Idea



<br/>

Potential outcome framework에서는 각각의 individual에 대해서 만약 treatment를 부여하였을 때의 결과값, treatment를 부여하지 않았을 때의 결과값인 potential outcome, 또는 conterfactual outcome를 비교하여 causal effect를 구합니다. 



* **Notation**



$Y_i(1)$ : $i$th individual이 treatment를 부여받았을 때의 outcome

$Y_i(0)$ : $i$th individual이 treatment를 부여받지 않았을 때의 outcome

$Y_i(1)-Y_i(0)$ : Causal effect(treatment effect) of the individual $i$





Causal inference에서의 가장 근본적인 문제는 각각의 individual $i$에 대해서 $Y_i(1)$과 $Y_i(0)$을 동시에 구할 수 없다는 것입니다. 따라서, 개개인에 대한 casual effect를 구하지 않고, 전체 집단((sub)population)의 outcome의 average를 비교하여 causal effect를 구합니다. 


$$
E(Y_i(1)-Y_i(0))
$$


이를 **Average treatment effect**라고 합니다.



위의 $Y_i(1), Y_i(0)$은 treatment를 부여받았을 때, 받지 않았을 때의 outcome이므로, 실제로 관측된 outcome을 $Y_i(1), Y_i(0)$을 이용하여 표현할 수 있습니다.



* **Notation**



$W_i$ : The treatment received

$W_i=1$ : $i$th individual이 treatment를 받음

$W_i=0$ : $i$th individual이 treatment를 받지 않음



위와 같이 $W_i$를 정의하면, $Y_i$는 다음과 같이 정의됩니다.


$$
Y_i=(1-W_i)Y_i(0)+W_iY_i(1)
$$




Randomized experiment가 아닌 observational study에서는 treatment 이외에도 outcome에 영향을 주는 변수들이 존재합니다. 



* **Notation**

  

$(X_i, \boldsymbol{Z_i})$ : Vector of covariates, $X_i$ is scalar, $\boldsymbol{Z_i}$ is M-vector



RD design에서는 $X_i$에 의해서 treatment $W_i$가 결정이 됩니다. 



각각의 individual마다 

 
$$
(Y_i, W_i, X_i, \boldsymbol{Z_i})
$$


를 관측할 수 있습니다.





RD design은 **Treatment** $W_i$가 $X_i$**의 cutoff에 의해서 결정이 될 때, Cutoff 근방의 Outcome을 비교하여 causal effect를 계산하는 방법입니다. ** 여기서 cutoff 근방은 cutoff에서 최대로 가까운 값들을 의미하고, 이를 정의하기 위해서 극한의 개념을 도입합니다. 즉 **cutoff 기준 outcome의 좌극한과 우극한을 비교하여** causal effect를 계산합니다. 





<br/>

*example*



특정 학교에서 중간 시험성적이 특정 점수(ex:70)보다 낮은 학생들을 대상으로 보충 수업을 실시했습니다. 이 후 기말 시험 성적을 비교하여 보충 수업의 효과를 파악하고 싶습니다. 이 때,



$Y_i$ : $i$번 째 학생의 기말시험 성적

$W_i$ : $i$번 째 학생의 보충수업 수강 여부

$X_i$ : $i$번 째 학생의 중간시험 성적



만약 $X$가 cutoff(70점) 근방인 학생들의  outcome을 비교하였을 때, 만약 차이가 있다면, 이 차이는 보충 수업의 효과로 해석할 수 있습니다. 





<br/>



#### 1.2 The sharp regression discontinuity design



<br/>



sharp regression discontinuity design에서는 $X_i$의 cutoff를 기준으로, cutoff보다 작으면 treatment $W_i$를 부여하지 않고, cutoff보다 크거나 같으면 treatment를 부여하는 case에서 사용합니다. SRD에서 $W_i$는 다음과 같이 정의됩니다.


$$
W_i=I\{X_i\geq c\}
$$
 

즉, $X_i<c$인 모든 individual에 대해서는 $W_i=0$, $X_i \geq c$인 모든 individual에 대해서는 $W_i=1$입니다. 이 때, 전체 treatment effect가 아닌, $X_i=c$에서의 treatment effect를 계산합니다.


$$
\lim_{x\downarrow c}E(Y_i | X_i=x) - \lim_{x\uparrow c}E(Y_i | X_i=x)
$$


위의 값이 **discontinuity point $X_i=c$에서의 average treatment effect**라고 합니다.


$$
\tau_{SRD} = E(Y_i(1)-Y_i(0) | X_i=c)
$$




![SRD](../../images/2022-01-06-RDguide/SRD.png)



다음 그래프를 보면 SRD design와 $\tau_{SRD}$를 시각적으로 확인할 수 있습니다. Figure 1 그래프에서는 $W_i$와 $X_i$의 그래프가 나와있습니다.  $X_i=6$을 기준으로 treatment가 정해집니다. 입니다. 즉 $X_i=6$을 기준으로 6보다 작으면 $W_i=0$이고, 6보다 크거나 같으면 $W_i=1$입니다. 

Figure 2 그래프에서는 $X_i$와 $Y_i$의 그래프가 나와있습니다. 검읜색 직선은 실제로 관측된 outcome에 대한 함수이고, 점선은 각각 $W_i=0, W_i=1$에 대한 potential outcome $Y_i(0), Y_i(1)$에 대한 그래프입니다. 보는 것과 같이 cutoff $X_i=6$에서 discontinuity가 발생하였으므로, causal effect가 존재한다고 해석할 수 있습니다.



Figure 2 그래프의 outcome과 $X_i$에 대한 그래프  식은 다음과 같이 나타낼 수 있습니다.


$$
E(Y | X=x)  = E(Y|X=x, W=1)P(W=1|X=x) + E(Y | X=x, W=0)P(W=0 | X=x)
$$
 



$\tau_{SRD}$를 해석하기 위해서는 몇가지 가정이 필요합니다. 



* **Assumption 1** Unconfoundedness assumption


$$
Y_i(0), Y_i(1) \perp W_i | X_i
$$
 

$X_i$가 given되었을 때, potential outcome과 treatment는 독립임을 가정합니다. 즉, conditional exchangeability를 가정합니다. 이는 $X_i$가 given되었을 때, 다른 covariates $\boldsymbol{Z_i}$는 treatment에 영향을 끼치지 않음을 의미합니다. 



Unconfoundedness auusmption은 observational study를 randomized experiment로 해석하기  위해 필요한 가정 중 하나입니다. 위 가정에 더불어 observational study에서는 positivity 가정을 추가합니다.



* Positivity


$$
0 < Pr(W_i=1|X_i=x)<1 \ for \ all \ x
$$




하지만, 위 가정은 RD design에서는 성립할 수 없습니다. SRD design의 경우 cutoff보다 작은 $X_i$에 대해서 $W_i=0$ 이기 때문입니다. 



즉, 모든 $X$값에 대해 treatment가 부여된 individual과 부여되지 않은 individual이 존재해서, average treatment effect를 구하는데, **RD design에서는 positivity 조건을 만족하지 않는 경우가 존재하기 때문에, 전체에 대해서 average treatment effect를 구할 수 없습니다.** 대신, **RD design에서는 cutoff 근방의 outcome을 비교해서 cutoff 근방의 average treatment effect를 구합니다.**


$$
\tau_{SRD}=E(Y(1)-Y(0)|X=c)=E(Y(1)|X=c)-E(Y(1)|X=c)
$$
 

SRD에서 $X=c$에서 $Y(1)$과 $Y(0)$를 동시에 구할 수 없습니다. 따라서, **$X=c$에서의 $Y(1)$과 $Y(0)$의 좌극한, 우극한 값을 이용하여 $\tau_{SRD}$를 구합니다.** 극한값을 정의하기 위해서 몇 가지 가정을 추가합니다. 



* **Assumption 2.1** Continuity of Conditional Regression Functions


$$
E(Y(0)|X=x), E(Y(1) | X=x)
$$


are continuous in $x$



일반적으로, conditional expectation이 아닌 conditional distribution이 $x$에 대해 continuous하다를 가정합니다.



* **Assumption 2.2** Continuity of Conditional Distribution Functions


$$
F_{Y(0)|X}(y|x), F_{Y(0)|X}(y|x)
$$


are continuous in $x$ for all $y$



위 두 가정 하에서


$$
E(Y(0)|X=c)=\lim_{x\uparrow c}E(Y(0)|X=x) = \lim_{x\uparrow c}E(Y(0)|X=x, W=0) = \lim_{x\uparrow c}E(Y|X=x)
$$


가 되고,


$$
E(Y(1)|X=c)=\lim_{x\downarrow c}E(Y(1)|X=x) = \lim_{x\downarrow c}E(Y(1)|X=x, W=1) = \lim_{x\downarrow c}E(Y|X=x)
$$


즉, potential outcome $Y(0), Y(1)$의 conditional expectaion을 outcome의 conditional expectation으로 구할 수 있게 됩니다. 



<br/>



#### 1.3 The FRD design



<br/>



Fuzzy regression discontinuity design에서는, treatment $W_i$가 부여될 확률이 $X_i$의 cutoff를 기준으로 불연속적으로 변합니다. SRD design에서는 cutoff보다 작은 모든 $X_i$에 대해서 $W_i=0$,  cutoff보다 크거나 같은 모든 $X_i$에 대해서 $W_i=1$를 부여했다면, FRD에서는


$$
\lim_{x\downarrow c}Pr(W_i=1 | X_i=x) \neq \lim_{x\uparrow c}Pr(W_i=1 | X_i=x)
$$


$W_i$가 부여될 확률이 불연속적으로 변합니다. 따라서, SRD보다 일반적인 경우를 다루는 design이 FRD design입니다. 



FRD design에서는 cutoff에서의 treatment effect를 다음과 같이 정의합니다.


$$
\tau_{FRD} = \frac{\lim_{x\downarrow c}E(Y|X=x)-\lim_{x\uparrow c}E(Y|X=x)}{\lim_{x\downarrow c}E(W=1 | X=x) - \lim_{x\uparrow c}E(W=1 | X=x)}
$$


와 같이 정의합니다. 



$\tau_{FRD}$를 해석하기 위해서, $W_i(x)$를 정의합니다.



* **Notation**

$W_i(x)$ : Potential treatment status given cutoff point $x$, for $x$ in some small neighborhood around $c$



Treatment가 $x$에 의해서 결정되기 때문에, $x$값이 변화함에 따라서 treatment 부여 여부 또한 변화할 수 있습니다. 따라서 $W_i(x)$ 또한 potential treatment status로 생각할 수 있습니다. 즉, $x$가 우리가 원하는대로 조작할 수 있다는 가정(manipulable)하에서 potential treatment status를 정의합니다. 



* **Assumption 2.3** Monotonicity


$$
W_i(x)
$$


is non-increasing in $x$ at $x=c$



위 가정을 적용하면, complier 개념을 이용하여 $\tau_{FRD}$를 해석할 수 있습니다. 



* **Notation** Compiler



**Complier** is a unit such that


$$
\lim_{x\downarrow X_i}W_i(x)=0, \lim_{x\uparrow X_i}W_i(x)=1
$$


즉, cutoff를 기준으로 treatment 부여 여부가 바뀌는 individual을 complier라고 합니다. (instrumental variable에서의 complier와 같은 개념입니다.)



FRD design에서는 treament 부여여부가 확률적으로 결정되기 때문에, $x=X_i$를 기준으로 결정되는 $W_i$에 따라서, 3가지 유형의 individual로 구분할 수 있습니다. 



* **Notation**



**Nevertakers** are units with


$$
\lim_{x\downarrow X_i}W_i(x)=0, \lim_{x\uparrow X_i}W_i(x)=0
$$
 

**Alwaystakers** are units with


$$
\lim_{x\downarrow X_i}W_i(x)=1, \lim_{x\uparrow X_i}W_i(x)=1
$$


즉, $x=X_i$ 근방의 값과 상관없이 항상 treatment값이 0인 unit을 nevertaker, 항상 treatment값이 1인 unit을 alwaystaker, 마지막으로 $x=X_i$를 기준으로 treatment 부여 여부가 바뀌는 unit을 complier라고 합니다. 



이를 생각하면, $\tau_{FRD}$에서의 분모


$$
\lim_{x\downarrow c}E(W=1 | X=x) - \lim_{x\uparrow c}E(W=1 | X=x)
$$


는 $X=c$에서 complier일 확률을 뜻합니다. 



따라서


$$
\begin{aligned}\tau_{FRD} &= \frac{\lim_{x\downarrow c}E(Y|X=x)-\lim_{x\uparrow c}E(Y|X=x)}{\lim_{x\downarrow c}E(W=1 | X=x) - \lim_{x\uparrow c}E(W=1 | X=x)} \\
&=E(Y_i(1)-Y_i(0) | \ unit \ i \ is \ a \ complier \ and \ X_i=c  )
\end{aligned}
$$


즉, $\tau_{FRD}$는 $X_i=c$에서의 complier들의 average treatment effect가 됩니다. 





![FRD](../../images/2022-01-06-RDguide/FRD.png)



다음 그래프를 보면 FRD design을 시각적으로 확인할 수 있습니다. Figure 3은 $X$와 $Pr(W|X=x)$를 나타낸 그래프입니다. SRD design과는 다르게, $X=x$일 때, treatment 부여 여부가 확률값으로 존재하고, cutoff인 $X=6$을 기준으로 불연속입니다. 



Figure 4에서는 potential and observed outcome regression입니다. 실선이 observed outcome regression, 점선이 $Y(1), Y(0)$의 outcome regression 그래프를 나타냅니다. $X=6$에서 불연속이 발생하는데, 이를 통해 causal effect가 있다고 해석할 수 있습니다.



observed outcome regression의 값은 다음과 같이 구할 수 있습니다.


$$
E(Y|X=x) = E(Y(0)|X=x, W=0)P(W=0|X=x) + E(Y(1)|X=x, W=1)P(W=1|X=x)
$$


<br/>



#### 1.4 The FRD design and unconfoundedness



<br/>



Unconfounded assumption에서는


$$
Y(0), Y(1) \perp W |X
$$


를 가정하고, 이 때 $X=c$에서의 average treatment effect는


$$
E(Y(1)-Y(0)|X=x )= E(Y|W=1, X=c) - E(Y | W=0, X=c)
$$


로 해석할 수 있습니다. 즉, $X=c$에서의 treatment group($W=1$)과 control group($W=0$)간의 outcome의 비교를 통해 treatment effect를 정의합니다.



하지만, FRD design에서는 위 방법으로 정의한 average treatment effect는 잘못된 접근입니다. 왜냐하면, **treatment group에 속하는 unit 중 complier 뿐만 아니라 nevertaker, alwaystaker 또한 존재하기 때문입니다.** 마찬가지로, control group에 속하는 unit 중에서도 nevertaker, alwaystaker 또한 존재합니다. nevertaker, alwaystaker는 $X=c$에서 $W$가 변화하지 않기 때문에, FRD에서 구하는 $\tau_{FRD}$에 영향을 끼치지 않습니다. 따라서, complier와 nevertaker와 alwaystaker를 모두 고려한 treatment group과 control group간 outcome 비교는 의미가 없습니다. 



Observational study에서 unconfoundedness를 가정하는 이유 중 하나는, covariates들이 비슷하고 treatment만 다른 두 group의 outcome의 차이에 영향을 끼치는 것은 오직 treatment임을 말하기 위해서입니다. 하지만, FRD에서는 covariates에 따라서 treatment를 받을 확률이 cutoff에서 불연속이기 때문에, unconfoundedness 가정이 attractive하지 않습니다. 즉, **$X$가 cutoff인 $c$ 근방에 존재하는 unit들에 대해서, $X=c$보다 작은 group과 큰 group 사이에는 treatment 부여 확률이 다르기 때문에, 두 group에는 어떠한 차이가 존재한다고 말할 수 있습니다. (비슷하다고 말할 수 없습니다.)**



 

<br/>



#### 1.5 External validity



<br/>



SRD, FRD design의 가장 큰 특징이자 단점은 $X=c$에서의 average treatment effect를 추정한다는 점입니다. 만약 우리가 전체 데이터에 대해 treatment effect를 계산하는 것이 목적이라면, SRD design과 FRD design으로는 한계가 발생합니다. FRD는 이에 추가하여, $X=c$에서의 unit 중 complier에 해당하는 unit들의 average treatment effect를 계산하기 때문에, SRD design에서보다 추정되는 unit이 적습니다. 따라서, local estimate가 global estimate가 된다는 강한 가정 없이는 전체 population에 대한 average treatment effect를 추정할 수 없습니다. 

하지만, RD design은 다른 분석방법과 비교하여 $X=c$에서의 average caual effect는 확실히 보일 수 있습니다. 즉 locality, internal validity 측면에서는 강한 분석방법입니다. 





<br/>

### 2. Graphical analyses



<br/>



SRD, FRD design을 적용하기 전에, 데이터를 파악하여 SRD, FRD design의 가정을 만족하는지 확인하는 작업이 필요합니다. 데이터 시각화는 이러한 가정을 만족하는지 안하는지 확인하는데 큰 도움이 됩니다. 대부분의 graphical analysis는 cutoff에서의 불연속성과 관련되어 있습니다.





<br/>



#### 2.1 Forcing variable vs Outcome





<br/>



첫 번째로 분석할 plot은 forcing variable과 outcome을 비교한 histogram-type estimate plot입니다. 



binwidth $h$와 cutoff $c$의 좌우에 존재하는 bin 개수$K_0, K_1$에 대해서 bins $(b_k, b_{k+1}]$을 만듭니다. ($k=1, ...., K=K_0+K_1$)


$$
b_k=c-(K_0-k+1)h
$$


이 후


$$
N_k=\Sigma_{i=1}^N I\{b_k<X_i\leq b_{k+1}\}
$$
와 


$$
\bar{Y}_k = \frac{1}{N_k}\Sigma_{i=1}^N Y_i I\{b_k < X_i \leq b_{k+1}\}
$$


를 통해 bin마다 average outcome을 계산하여 plot에 표시합니다. (bin의 중앙값을 $x$값, $\bar{Y}_k$를 $y$값으로 가지는 점을 찍어 plot을 그립니다.)



다음의 plot을 통해 확인해야 하는점은



* $X=c$에서 실제로 discontinuity가 발생했는지 여부
* cutoff 이외의 다른 점에서 discontinuity가 발생했는지 여부



 Cutoff에서 discontinuity 발생 여부를 통해 RD design을 시행하기 전 시각적으로 treatment가 outcome에 영향을 주었는지 확인 할 수 있습니다. 



 Cutoff 이외의 다른 점에서 discontinuity가 발생하였다면, RD design 해석에서 오류가 발생합니다. Cutoff 이외의 점은 treatment 값의 변화가 연속적입니다. 그럼에도 불구하고 불연속점이 발생하였다면, observation 사이에 treatment가 아닌 알 수 없는 다른 변수가 존재하여 outcome에 영향을 끼치는 것을 생각할 수 있습니다. 이러한 다른 변수는 cutoff에서의 discontinuity에 또한 영향을 끼칠 수 있기 때문에, 위 상황에서 RD design을 통해 구한 average treatment effect에는 오차가 발생합니다. 





<br/>



#### 2.2 Forcing variable vs Covariates



<br/>



RD design에서 $X=c$ 에서의 outcome을 비교할 때, $X$값이 아닌 다른 $\boldsymbol{Z}$를 신경쓸 필요가 없는 이유 중 하나는, $X=c$ 근방의 데이터 값들은 $\boldsymbol{Z}$ 값들 또한 비슷하기 때문입니다. 따라서 $X=c$ 근방의 unit에 대해서 $\boldsymbol{Z}$ 가 outcome에 가하는 영향은 비슷하기 때문에, 굳이 $\boldsymbol{Z}$를 신경쓸 필요 없이 $X$와 outcome만의 비교를 통해 causal effect를 추정할 수 있습니다. 이러한 논리가 적용되기 위해서는 $\boldsymbol{Z}$ 의 모든 element가 $X=c$에서 연속이어야 한다는 가정이 필요합니다. 따라서, $X$와 outcome $Y$의 histogram-type estimate plot처럼, 각각의 $Z_j$(\boldsymbol{Z}의 $j$th element)와 $X$의 histogram-type estimate plot을 이용하여 $X=c$에서 $Z_j$가 불연속인지 연속인지 확인을 해주어야 합니다.







<br/>



#### 2.3 Density of the forcing variable



<br/>



마지막으로 forcing variable인 $X$의 desity plot(or histogram)을 이용하여 $X=c$에서 density가 불연속인지 확인을 해주어야 합니다. $X=c$에서 density가 불연속이라면, 이는 각각의 unit들이 의도적으로 $X=c$보다 큰 값 또는 작은 값을 선택한 것으로 해석할 수 있습니다.(individuals are manipulable). 이는 RD design 해석에 오류를 발생시킬 수 있습니다. 즉, treatment의 효과를 개개인이 알고, cutoff 또한 알고 있어서 의도적으로 treatment를 받으려고(또는 받지 않으려고) forcing variable을 조정하면, 실제 treatment effect를 확인하는데 오차가 발생합니다.



(내용 추가 예정)